# Built To Last â€” Commerce scaffolding

Adds minimal integrations for:
- Supabase (auth + storage for orders)
- Stripe Checkout (hosted checkout)
- Cart system (client-only, localStorage)
- Customer account page (view orders + tracking)
- Admin page (list orders, update tracking/status)

## Getting Started

1) Copy env file

```
cp .env.example .env.local
```

Fill in:
- NEXT_PUBLIC_SUPABASE_URL
- NEXT_PUBLIC_SUPABASE_ANON_KEY
- SUPABASE_SERVICE_ROLE (server only, used by admin API)
- STRIPE_SECRET_KEY
- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY (not required for hosted checkout, but useful later)
- ADMIN_TOKEN (any strong random string you will use to access the admin API/UI)

2) Install deps and run

```
npm install
npm run dev
```

Open http://localhost:3000

## Supabase setup
Create a table named `orders` with the following minimal schema (SQL):

```sql
create table if not exists public.orders (
  id bigint generated by default as identity primary key,
  created_at timestamptz not null default now(),
  status text not null default 'created',
  total_cents integer not null default 0,
  customer_email text,
  tracking_number text,
  stripe_session_id text,
  items jsonb
);
-- RLS: customers can read their own orders by email
alter table public.orders enable row level security;
create policy "read own orders" on public.orders
  for select using (auth.email() is not null and customer_email = auth.email());
```

Notes:
- The admin API uses SUPABASE_SERVICE_ROLE to list/update orders and bypass RLS.
- The customer account page uses the anon key and signed-in user's email to read their orders.

## Stripe Checkout
- The cart page POSTs to `/api/create-checkout-session` which creates a hosted Checkout Session and inserts a provisional order (status `created`).
- Success redirects to `/account?status=success` and the app clears the local cart.
- For production, add a Stripe webhook to mark orders as `paid`/`fulfilled` after payment. (Not included in this minimal scaffold.)

## Pages
- `/` existing marketing/home.
- `/cart` manage items and begin checkout.
- `/account` sign in via magic link and see your orders + tracking.
- `/admin` enter ADMIN_TOKEN to fetch orders and update tracking/status.

## Header/Nav
- Cart badge is visible on desktop via the new Cart button, and Account link is present.
- Mobile menu includes Account and Cart links.

## Adding items to cart
Use the CartContext hook anywhere in client components:

```tsx
import { useCart } from '@/context/CartContext'
const { addItem } = useCart()
addItem({ id: 'sku_1', title: 'Tee', price: 3500, quantity: 1, image: '/tee.png' })
```

## Notes
- This is a minimal scaffold to get the flows in place. Secure the admin with a better auth strategy (e.g., Supabase Auth with an admin role) for production.
